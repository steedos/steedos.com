---
title: 组件
description: 组件是微页面的基本元素，微页面中不但有非常丰富的组件可以直接使用，同时还支持自定义组件。
---

## Amis原生组件

几乎所有的amis原生组件都适用于华炎魔方微页面，请参阅 [Amis 组件](https://aisuda.bce.baidu.com/amis/zh-CN/components)。

## 华炎魔方组件

我们为 amis 扩展了以下组件用于快速实现华炎魔方各种界面能力。

- [对象表单 ObjectForm](/docs/amis/object_form)
- [对象列表 ObjectListView](/docs/amis/object_listview)
- [对象表格 ObjectTable](/docs/amis/object_table)
- [标题面板 RecordDetailHeader](/docs/amis/record_detail_header)
- [相关表 RecordDetailRelatedList](/docs/amis/record_detail_related_list)


## @data.change事件

在amis广播事件可以自定义派发的事件名称`eventName`，其他渲染器可以监听自定义事件并配置响应动作。[了解更多广播事件](https://aisuda.bce.baidu.com/amis/zh-CN/docs/concepts/event-action)。

华炎魔方基于amis广播事件，实现了基于对象的`@data.change`事件，只需要在组件中按规范监听相关对象的`@data.change`事件，可以很方便的实现刷新**对象列表**和**表单数据**功能。 


### 名称规范

事件名称规范：`@data.changed.对象的API名称`，表示触发某个对象的`@data.change`事件。

### 触发

要触发对象的`@data.change`事件，`eventName`按上述名称规范，并配置`actionType: 'broadcast'`。  

以下示例演示了点击按钮时触发一个名为`instance_tasks`的对象的`@data.change`事件。`actions.data`中的数据会传递给目标事件，可通过`event.data.xxx`直接获取。

```json
  {
    "type": "button",
    "label": "广播一下",
    "onEvent": {
      "click": {
        "actions": [
          {
            "actionType": "broadcast",
            "args": {
              "eventName": "@data.changed.instance_tasks"
            },
            "data":{
              "objectName": "instance_tasks"
            }
          }
        ]
      }
    }
  }
```

### 监听

要监听`@data.change`事件，事件名按上述名称规范即可。

以下示例演示了一个监听名为`instance_tasks`的对象的`@data.change`事件。当事件触发时会执行相关动作，传递的数据通过`event.data.xxx`获取。

```json
  "onEvent": {
    "@data.changed.instance_tasks": {
      "actions": [
        {
          "actionType": "toast",
          "args": {
            "msgType": "info",
            "msg": "传递的数据：${event.data.objectName}",
            "position": "top-center"
          }
        }
      ]
    }
  }
```

### 应用

华炎魔方很多内置组件都监听了对象的`@data.change`事件，基于amis的广播事件特性可以很方便的调用这些组件的功能和行为，比如组件的刷新功能。 


#### 对象列表组件

所有的对象列表组件都监听了对象的`@data.change`事件，支持执行以下行为：
- 刷新对象列表组件
- 跳转到记录详细页

详情请参考 [对象列表源码](https://github.com/steedos/steedos-widgets/blob/1.2/packages/@steedos-widgets/amis-object/src/amis/AmisObjectListview.tsx#L83)。  


##### **刷新对象列表组件**

以下示例演示点击按钮后，刷新名为`project`的对象列表组件：

```json
{
  "type": "button",
  "label": "刷新对象列表组件",
  "onEvent": {
    "click": {
      "actions": [
        {
          "actionType": "broadcast",
          "args": {
            "eventName": "@data.changed.project"
          },
          "data": {
            "objectName": "project",
            "recordId": "xxx" // 此处请保持非空，并不需要真实的记录ID，否则将跳转对象表单
          }
        }
      ]
    }
  }
}
```
点击上述示例中的按钮后会触发绑定`project`对象的对象列表组件的`@data.changed`事件，在该事件中，会根据传入的参数判断是否刷新对象列表组件。

要刷新对象列表组件，需在`data`中配置以下参数：
- objectName: `String`。要触发广播事件对象的对象Api名称，即对象列表绑定的对象api名称。
- recordId: `String`。此处请保持非空，并不需要真实的记录ID，表示非新建记录，否则将跳转对象表单。

在华炎魔方对象列表页面中**编辑**记录后，会刷新对象列表组件，就是因为在弹出的编辑表单组件中监听了提交成功事件并触发了页面中对象列表组件的`@data.change`事件，在`@data.change`事件中会执行刷新动作。
详情请参考 [对象表单组件源码](https://github.com/steedos/steedos-widgets/blob/1.2/packages/%40steedos-widgets/amis-lib/src/lib/converter/amis/index.js#L350)。

<alert type="info">
源码中的data没有传入`recordId`，是因为表单中的数据会传入`data`，在编辑记录时表单中包含`recordId`变量，`@data.change`事件中的`event.data.recordId`不为空。
</alert>
<br/>

##### **跳转到记录详细页**

在华炎魔方对象列表页面中**新建**记录后，会跳转到记录详细页，就是因为在弹出的编辑表单组件中监听了提交成功事件并触发了页面中对象表单组件的`@data.change`事件，在`@data.change`事件中会执行跳转动作。
详情请参考 [对象表单组件源码](https://github.com/steedos/steedos-widgets/blob/1.2/packages/%40steedos-widgets/amis-lib/src/lib/converter/amis/index.js#L350)。  

<alert type="info">
在新建记录时，表单的`recordId`为空，所以会跳转到记录详细页，而不是刷新对象列表组件。

</alert>

要跳转到记录详细页，需在`data`中配置以下参数：
- objectName: `String`。要触发广播事件对象的对象Api名称，即对象列表绑定的对象api名称。
- recordId: `String`。此处请保持为空，表示新建记录。


#### 对象表单组件

所有的对象表单组件只读模式都监听了对象的`@data.change`事件，支持执行以下行为： 
- 刷新对象表单组件
- 跳转到对象列表页面

详情请参考 [对象表单组件只读模式源码](https://github.com/steedos/steedos-widgets/blob/1.2/packages/@steedos-widgets/amis-lib/src/lib/converter/amis/index.js#L426)。  

##### **刷新对象表单组件**

以下示例演示点击按钮后，刷新名为`project`的对象表单组件。

```json
{
  "type": "button",
  "label": "刷新对象表单组件",
  "onEvent": {
    "click": {
      "actions": [
        {
          "actionType": "broadcast",
          "args": {
            "eventName": "@data.changed.project"
          },
          "data": {
            "objectName": "project"
          }
        }
      ]
    }
  }
}
```

在只读模式下，点击上述示例中的按钮后会触发绑定`project`对象的对象表单组件的`@data.changed`事件，在该事件中，会根据传入的参数判断是否刷新对象表单组件。

要刷新对象表单组件，需在`data`中配置以下参数：
- objectName: `String`。要触发广播事件对象的对象Api名称，即对象列表绑定的对象api名称。

在华炎魔方记录详情页中编辑记录后，会刷新只读页面中的对象表单组件，就是因为在弹出的编辑表单组件中监听了提交成功事件并触发了页面中只读的对象表单组件的`@data.change`事件，在`@data.change`事件中会执行刷新动作。
[对象表单组件源码](https://github.com/steedos/steedos-widgets/blob/1.2/packages/%40steedos-widgets/amis-lib/src/lib/converter/amis/index.js#L350)。

##### **跳转到对象列表页面**

在华炎魔方记录详情页中删除记录后，会跳转对象列表页面页面，就是因为触发了点击事件并触发了页面中只读的对象表单组件的`@data.change`事件，在`@data.change`事件中会执行跳转动作。

详情请参考 [删除按钮源码](https://github.com/steedos/steedos-widgets/blob/1.2/packages/%40steedos-widgets/amis-lib/src/schema/standard_delete.amis.js#L44)。


#### 相关表组件

所有的相关表组件都监听了对象的`@data.change`事件，支持执行以下行为： 
- 刷新相关表组件

详情请参考 [相关表组件源码](https://github.com/steedos/steedos-widgets/blob/1.2/packages/%40steedos-widgets/amis-lib/src/lib/objectsRelated.js#L162)。

##### **刷新相关表组件**

以下示例演示点击按钮后，刷新名为`project`的相关表组件。

```json
{
  "type": "button",
  "label": "刷新相关表",
  "onEvent": {
    "click": {
      "actions": [
        {
          "actionType": "broadcast",
          "args": {
            "eventName": "@data.changed.project"
          },
          "data": {
            "objectName": "project"
          }
        }
      ]
    }
  }
}
```

点击上述示例中的按钮后会触发绑定`project`对象的相关表组件的`@data.changed`事件，在该事件中，会根据传入的参数判断是否刷新相关表组件。

要刷新相关表组件，需在`data`中配置以下参数：
- objectName: `String`。要触发广播事件对象的对象Api名称，即对象列表绑定的对象api名称。

在华炎魔方对象相关表中执行增、删、改后，会刷新相关表组件，就是因为触发了页面中相关表组件的`@data.change`事件，在`@data.change`事件中会执行刷新动作。

## 自定义组件

[Amis](https://aisuda.bce.baidu.com/amis/zh-CN/docs) 本身提供了非常丰富的组件功能，基本它可以实现大部分业务场景的UI界面需求。

如果遇到适合自己开发自定义组件的场景，我们也可以通过自定义资产包来把自定义组件集成到amis设计器中，这样我们就可以实现任何我们想要的UI效果了。 

只要把自定义资产包地址配置到环境变量 `STEEDOS_PUBLIC_PAGE_ASSETURLS` 中，华炎魔方会根据资产包中配置的资源包地址自动把相关自定义组件加载并集成到amis引擎中，非常方便。

```bash
STEEDOS_PUBLIC_PAGE_ASSETURLS=https://unpkg.com/@steedos-widgets/example@0.0.6/dist/assets.json
```

资产包的地址只要可以访问即可，它可以是发布到npm的包(unpkg.com)地址，也可以是其他任何可以被当前服务访问的地址，比如在远程开发环境中公开的资产包地址。

下面的示例 [amis-custom-components](/docs/amis/example#amis-custom-components) 完整演示了如何在华炎魔方项目中通过引用自定义资产包的方式来集成自定义组件。

关于自定义资产包及自定义组件的开发，请参考下面的示例 [steedos-widgets](/docs/amis/example#steedos-widgets)。
